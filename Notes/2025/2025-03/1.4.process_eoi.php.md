

- **I. Initial Setup**
    
    - A. Include `settings.php`
        - 1. Database connection details (host,host, host,user, pwd,pwd, pwd,sql_db)
    - B. Establish Database Connection
        - 1. `mysqli_connect()`
        - 2. Error Handling (if connection fails)
    - C. Check for Direct Access
        - 1. `if (empty($_POST))`
        - 2. `header("Location: apply.php")`
        - 3. `exit;`
- **II. Data Handling**
    
    - A. Sanitize Input
        - 1. `sanitizeInput()` function (trim, stripslashes, htmlspecialchars)
    - B. Retrieve Form Data
        - 1. `$_POST['jobref']`, `$_POST['firstName']`, etc.
        - 2. `$_POST['skills']` (handle as array)
        - 3. `$_POST['otherskills_input']` (corrected name)
        - 4. `$_POST['dob']`
        - 5. `$_POST['gender']`
    - C. Prepare for Validation
        - 1. `$errors = [];` (initialize error array)
- **III. Validation**
    
    - A. Job Reference
        - 1. `preg_match("/^[A-Za-z0-9]{5}$/")`
        - 2. Add error to `$errors` if invalid
    - B. First Name
        - 1. `strlen($firstName) > 20 || !ctype_alpha($firstName)`
        - 2. Add error to `$errors` if invalid
    - C. Last Name
        - 1. `strlen($lastName) > 20 || !ctype_alpha($lastName)`
        - 2. Add error to `$errors` if invalid
    - D. Date of Birth
        - 1. `explode('/', $dob)`
        - 2. `checkdate()`
        - 3. Calculate age
        - 4. Check age between 15 and 80
        - 5. Add error to `$errors` if invalid
    - E. Gender
        - 1. `empty($gender)`
        - 2. Add error to `$errors` if invalid
    - F. Street Address
        - 1. `strlen($street) > 40`
        - 2. Add error to `$errors` if invalid
    - G. Suburb/Town
        - 1. `strlen($suburb) > 40`
        - 2. Add error to `$errors` if invalid
    - H. State
        - 1. `in_array($state, $validStates)`
        - 2. Add error to `$errors` if invalid
    - I. Postcode
        - 1. `preg_match($statePostcodes[$state], $postcode)`
        - 2. Add error to `$errors` if invalid
    - J. Email
        - 1. `filter_var($email, FILTER_VALIDATE_EMAIL)`
        - 2. Add error to `$errors` if invalid
    - K. Phone
        - 1. `preg_match("/^[0-9 ]{8,12}$/")`
        - 2. Add error to `$errors` if invalid
    - L. Other Skills
        - 1. `isset($_POST['otherskills_checkbox']) && empty($otherSkills)`
        - 2. Add error to `$errors` if invalid
    - M. Error Handling (if errors exist)
        - 1. Display errors in a list
        - 2. `exit;`
- **IV. Database Operations**
    
    - A. Handle Skills
        - 1. `$skills = isset($_POST['skills']) ? $_POST['skills'] : [];`
        - 2. `$skillString = implode(", ", $skills);`
    - B. Check if Table Exists
        - 1. `SHOW TABLES LIKE '$tableName'`
    - C. Create Table (if it doesn't exist)
        - 1. `CREATE TABLE` statement (includes all fields, `Skills TEXT`)
        - 2. Error Handling (if table creation fails)
    - D. Insert Data
        - 1. `INSERT INTO` statement
        - 2. Prepared Statement (`mysqli_prepare()`)
        - 3. Bind Parameters (`mysqli_stmt_bind_param()`)
        - 4. Execute Statement (`mysqli_stmt_execute()`)
        - 5. Get Auto-Generated ID (`mysqli_insert_id()`)
        - 6. Display Success Message (with EOI number)
        - 7. Error Handling (if insertion fails)
        - 8. Close Statement (`mysqli_stmt_close()`)
- **V. Closing**
    
    - A. Close Database Connection
        - 1. `mysqli_close($dbconn)`

This mind map outlines the major sections and operations performed in the `process_eoi.php` script. Each section can be further expanded with more details as needed. This should give you a good overview of the script's logic and structure.